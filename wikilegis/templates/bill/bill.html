{% extends "base_with_sidebar.html" %} {% load static humanize i18n %} {% load video from embed_video_tags %} {% load cropping %} {% load proposals %} {% load subscribers %}

{% block extrameta %}
<meta property="og:type"   content="article" />
<meta property="og:title" content="{{ bill.epigraph }}" />
<meta property="og:description" content="{{ bill.description }}" />
<meta property="og:image:url"  content="http://wikilegis.labhackercd.net/static/img/share/{{ bill.theme }}.jpg" />
<meta property="og:image:type" content="image/png" />
<meta name="twitter:card" content="photo" />
<meta name="twitter:site" content="@edemocracia" />
<meta name="twitter:title" content="{{ bill.epigraph }}">
<meta name="twitter:description" content="{{ bill.description }}">
<meta name="twitter:image" content="http://wikilegis.labhackercd.net/static/img/share/{{ bill.theme }}.jpg">
{% endblock %}

{% block content2 %} {% comment %}TODO Remove these funny scroll sheningans{% endcomment %}
<style>
    select {display:block;}
</style>
<div class="container">

  <div class="row valign-wrapper">
    <div class="col s2 l1 valign">
      <div class="circle {% if bill.status = 'closed' %}border-red{% endif %} valign-wrapper">
        <img class="logo" src="{% static 'img/icons/' %}{{ bill.theme }}{% if bill.status = 'closed' %}-2{% endif %}.png" alt="{{ bill.get_theme_display }}" title="{{ bill.get_theme_display }}"/>
      </div>
    </div>
    <div class="col s10 l11 valign">
      <h4 class="pl-title">{{ bill.title }}</h4>

      {% if bill.status = "closed" %}
        <h4 class="pl-title closed"> ({% trans "Participations Closed" %})</h4>
      {% endif %}

    </div>
  </div>

  <div class="row">

    <div class="col s12 l3 push-l9">
      <div class="pl-full pl-description">

        {% if user.is_authenticated and bill.status = "published"  %}
          {% subscriber bill.id request.user.id as newsletter_status %}
          <form action="{% url 'verify_newsletter' bill.id %}#btn_newsletter" method="get">
          {% if newsletter_status %}
            <button class="subscribe-cancel btn-flat waves-effect waves-light valign-wrapper" type="submit">
              <i class="material-icons valign left">backspace</i>
              <span class="header-text valign">{% trans "Unsubscribe" %}</span>
            </button>
          {% else %}
            <ul class="subscribe-button collapsible">
              <li>
                <div class="subscribe-header collapsible-header waves-effect waves-light valign-wrapper">
                  <i class="material-icons valign">email</i>
                  <span class="header-text valign">{% trans "Subscribe to this bill" %}</span>
                </div>
                <div class="subscribe-body collapsible-body">

                  <p>{% trans "You can be notified of changes in this bill via e-mail by subscribing to it." %}</p>

                  <div class="subscribe-options">
                    <div>
                      <input class="with-gap" value="weekly" name="periodicity" type="radio" id="periodicity_weekly" checked>
                      <label for="periodicity_weekly">{% trans "Weekly" %}</label>
                    </div>

                    <div>
                      <input class="with-gap" value="daily" name="periodicity" type="radio" id="periodicity_daily">
                      <label for="periodicity_daily">{% trans "Daily" %}</label>
                    </div>
                  </div>

                  <button class="subscribe-submit btn-flat waves-effect waves-light" type="submit">{% trans "Subscribe" %}</button>
                </div>
              </li>
            </ul>
          {% endif %}
          </form>
        {% endif %}

        <div class="pl-info">
          {% if proposition.situation %}
            <span class="item">
              <span class="pl-subheading">{% trans "Bill status:" %}</span>
              <span class="pl-status">
                <a target="_blank" href="http://www.camara.gov.br/proposicoesWeb/fichadetramitacao?idProposicao={{ proposition.id_proposition }}">
                  {{ proposition.situation }}
                </a>
              </span>
            </span>

          {% endif %}
          <span class="item"><span class="pl-subheading">{% trans "Attendees:" %}</span> <span class="users-count">{{ attendees }}</span></span>
          <span class="item filter-proposals"><span class="pl-subheading">{% trans "Proposals:" %}</span> <span class="prop-count" id="filter-proposal">{{ proposals }}</span></span>
          {% if bill.closing_date %}
          <span class="item"><span class="pl-subheading">{% trans "Closing date:" %}</span> <span class="prop-count">{{ bill.closing_date|date:'d/m/Y' }}</span></span>
          {% endif %}
        </div>

        <div class="row">
          {% if proposition %}
            <div class="after-bar">
              <div class="user col s12">
                <div class="col m3 s2">
                  <div class="avatr">
                    {% if proposition.id_register %}
                    <div class="pic" style="background-image: url('http://www.camara.gov.br/internet/deputado/bandep/{{ proposition.id_register }}.jpg')"></div>
                    {% else %}
                    <div class="pic" style="background-image: url('{% static 'img/user.png' %}')"></div>
                    {% endif %}
                  </div>
                </div>
                <div class="col m9 s9">
                  <span class="user-name">
                    <div class="user-type">{% trans "AUTHOR" %}</div>
                    <a target="_blank" href="http://www.camara.leg.br/Internet/Deputado/dep_Detalhe.asp?id={{ proposition.id_register }}">{{ proposition.author }} </a>
                  </span>
                  <p class="p-uf">({{ proposition.party_author }}-{{ proposition.uf_author }})</p>
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <div class="row">
          {% if congressman %}
            <div class="after-bar">
              <div class="user col s12">
                <div class="col m3 s2">
                  <div class="avatr">
                    <div class="pic" style="background-image: url('http://www.camara.gov.br/internet/deputado/bandep/{{ congressman.user.id_congressman }}.jpg')"></div>
                  </div>
                </div>
                <div class="col m9 s9">
                  <span class="user-name">
                    <div class="user-type">{% trans "RAPPORTEUR" %}</div>
                    <a target="_blank" href="http://www.camara.leg.br/Internet/Deputado/dep_Detalhe.asp?id={{ congressman.user.id_congressman }}">
                      {{ congressman.parliamentary_name|title }}
                    </a>
                  </span>
                  <p class="p-uf">({{ congressman.party }}-{{ congressman.uf }})</p>
                </div>
              </div>
            </div>
          {% endif %}
        </div>

        <span class="votes-title">Voce apoia este projeto?</span>
        <div class="votes">
          <a class="upvote" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="imgView" x="0px" y="0px" viewBox="0 0 502.641 502.641" style="enable-background:new 0 0 502.641 502.641;" xml:space="preserve" class="detail convertSvgInline replaced-svg" width="32px" height="32px" data-id="13804" data-kw="social16">
              <g>
                <path d="M494.812,235.513c-15.207-36.929-43.94-55.674-85.442-55.674c0,0-27.244,0-49.742,0    c8.413-19.004,17.774-46.571,17.774-79.79c0-9.103-0.712-18.551-2.438-28.171c-6.536-38.612-32.895-59.147-70.364-55.027    c-14.841,1.704-19.931,15.79-32.227,49.936c-10.203,28.301-24.181,67.064-44.457,98.233    c-14.905,22.908-41.459,40.984-63.763,52.115v-2.826H0V458.21h164.197v-13.439c25.842-1.273,40.531-0.518,43.983,0.582    l29.379,17.062l21.959,13.697c21.334,11.497,114.649,12.597,154.663,6.665c51.446-7.507,63.871-49.677,64.389-51.489    C482.625,417.311,518.022,291.834,494.812,235.513z M447.572,422.424c-0.302,0.928-7.787,24.03-38.072,28.366    c-43.055,6.407-122.91,2.524-134.753-3.128c0.086,0.065-19.478-12.209-19.478-12.209l-36.908-20.73    c-8.564-2.869-27.977-3.193-54.164-2.028V252.036c26.446-10.699,67.409-33.672,90.77-69.415    c22.347-34.298,37.059-75.088,47.801-104.92c0,0,9.47-23.577,11.756-29.034c16.351,0.086,25.367,9.081,28.732,28.56    c1.337,7.636,1.855,15.207,1.855,22.52c0,48.34-24.828,86.822-25.195,87.297l-16.372,24.957l105.826,0.043    c28.301,0,45.428,11.023,55.631,35.743C481.05,286.722,457.754,387.091,447.572,422.424z"></path>
              </g>
            </svg>
            <p>0</p>
          </a>

          <a class="downvote" href="#">
            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="imgView" x="0px" y="0px" viewBox="0 0 502.641 502.641" style="enable-background:new 0 0 502.641 502.641;" xml:space="preserve" class="detail convertSvgInline replaced-svg" width="32px" height="32px" data-id="13804" data-kw="social16">
              <g>
                <path d="M494.812,235.513c-15.207-36.929-43.94-55.674-85.442-55.674c0,0-27.244,0-49.742,0    c8.413-19.004,17.774-46.571,17.774-79.79c0-9.103-0.712-18.551-2.438-28.171c-6.536-38.612-32.895-59.147-70.364-55.027    c-14.841,1.704-19.931,15.79-32.227,49.936c-10.203,28.301-24.181,67.064-44.457,98.233    c-14.905,22.908-41.459,40.984-63.763,52.115v-2.826H0V458.21h164.197v-13.439c25.842-1.273,40.531-0.518,43.983,0.582    l29.379,17.062l21.959,13.697c21.334,11.497,114.649,12.597,154.663,6.665c51.446-7.507,63.871-49.677,64.389-51.489    C482.625,417.311,518.022,291.834,494.812,235.513z M447.572,422.424c-0.302,0.928-7.787,24.03-38.072,28.366    c-43.055,6.407-122.91,2.524-134.753-3.128c0.086,0.065-19.478-12.209-19.478-12.209l-36.908-20.73    c-8.564-2.869-27.977-3.193-54.164-2.028V252.036c26.446-10.699,67.409-33.672,90.77-69.415    c22.347-34.298,37.059-75.088,47.801-104.92c0,0,9.47-23.577,11.756-29.034c16.351,0.086,25.367,9.081,28.732,28.56    c1.337,7.636,1.855,15.207,1.855,22.52c0,48.34-24.828,86.822-25.195,87.297l-16.372,24.957l105.826,0.043    c28.301,0,45.428,11.023,55.631,35.743C481.05,286.722,457.754,387.091,447.572,422.424z"></path>
              </g>
            </svg>
            <p>0</p>
          </a>
        </div>

        <div class="divider"></div>

        {% for item in videos %}
          <div class="pl-about video-descripition">
            {% video item.url %}
          </div>
          {% if not forloop.last %}
            <hr />
          {% endif %}
        {% endfor %}

        <ul class="subscribe-button collapsible">
          <li>
            <div class="subscribe-header collapsible-header waves-effect waves-light valign-wrapper">
              <i class="material-icons valign">http</i>
              <span class="header-text valign">{% trans "Embedding Code" %}</span>
            </div>
            <div class="subscribe-body collapsible-body">

              <p>{% trans "Copy and paste this code in your website." %}</p>

              <div class="subscribe-options embed-code">
                <code>
                <div>&lt;div class="wikilegis-widget" bill-id="{{ bill.id }}"&gt;&lt;/div&gt;</div>
                <div>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"&gt;&lt;/script&gt;</div>
                <div>&lt;script src="http://{{ domain }}static/js/widget.js"&gt;&lt;/script&gt;</div>
                </code>
              </div>
            </div>
          </li>
        </ul>

      </div>
    </div>

    <div class="col s12 l9 pull-l3">
      <div class="row pl-full list-amendment">
        <div class="col l11">
          <!--Article header template, uncomment subs and titles later-->
          <h4 class="amendment-title">{{ bill.epigraph }}</h4>
          <!--<h5 class="sub">{{ segment.content }}</h5>-->

          <div class="row">
            <div class="amendment-thead col s6 offset-s4 m5 offset-m1">

            </div>
            <div class="syllabus col s12 m6">
              {{ bill.description }}
            </div>
          </div>


          {% for segment in original_segments %}
            {% include "bill/_bill_segment_item.html" %}
          {% endfor %}
        </div>
      </div>

    </div>
  </div>
</div>

{% endblock %}

{% block partialscript %}
<script type="text/javascript">
    function verify_newsletter() {
        $.ajax({
            type: "GET",
            url: '{% url 'verify_newsletter' bill.id %}' + '?periodicity='+ $('#id_periodicity').val(),
            error: function (data) {
                alert("An error occurred, please try again."); // TODO: How do we internationalize strings inside JS?
            }
        });
    }
    $('.filter-proposals').click(function() {
      $('.list-amendment').toggleClass('hide-empty');
    });
</script>
{% endblock %}
